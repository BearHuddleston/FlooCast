#!/bin/bash
set -e

echo "Running pre-push checks..."

cd "$(git rev-parse --show-toplevel)"

if command -v uv &> /dev/null; then
    # Sync without installing project (wxPython needs GTK dev files)
    uv sync --extra dev --no-install-project
    RUN="uv run"
else
    source .venv/bin/activate 2>/dev/null || true
    RUN=""
fi

echo "=> ruff check"
$RUN ruff check .

echo "=> ruff format --check"
$RUN ruff format --check .

echo "=> pytest"
$RUN pytest -q

echo "All checks passed!"
